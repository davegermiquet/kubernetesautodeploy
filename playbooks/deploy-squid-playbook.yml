---
- hosts: '{{ target }}'
  gather_facts: "no"
  become: true

  tasks:
    - name: Install required system packages
      apt:
        pkg:
          - apt-transport-https
          - ca-certificates
          - software-properties-common
          - curl
          - python3-setuptools
          - squid
          - avahi-daemon
          - apache2


    - name: Create a symbolic link
      file:
        path: /var/www/html/ubuntu
        owner: www-data
        group: www-data
        state: directory

    - name: Change file ownership, group and permissions
      file:
        path: /var/www/html/
        owner: www-data
        group: www-data
        recurse: yes
        mode: '0770'

    - name: Update packages list
      apt: update_cache=yes

    - name: Explicitly specifying named matched groups
      replace:
        destfile: /etc/squid/squid.conf
        regexp: "^http_access allow localhost$"
        replace: http_access allow localnet

    - name: Start the command
      command: sudo systemctl restart squid